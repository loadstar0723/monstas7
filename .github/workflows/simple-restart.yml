name: Simple Restart

on:
  workflow_dispatch:
  push:
    branches: [ master ]

jobs:
  restart:
    runs-on: ubuntu-latest
    
    steps:
      - name: Simple Server Restart
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: 13.209.84.93
          username: ubuntu
          key: ${{ secrets.AWS_SERVER_KEY }}
          timeout: 30m
          script: |
            echo "🔄 간단한 서버 재시작..."
            
            # 1. 모든 것 정리
            pm2 kill
            killall -9 node npm 2>/dev/null || true
            
            # 2. 디렉토리 이동
            cd ~/monstas7/frontend || {
              cd ~
              git clone https://github.com/loadstar0723/monstas7.git
              cd monstas7/frontend
            }
            
            # 3. 최신 코드
            git pull origin master
            
            # 4. 패키지 설치
            npm install
            
            # 5. 개발 모드로 바로 실행
            PORT=3000 nohup npm run dev > server.log 2>&1 &
            
            # 6. 확인
            sleep 10
            echo "서버 PID: $(pgrep -f 'npm run dev')"
            echo "포트 확인:"
            netstat -tlnp | grep 3000
            echo "로그:"
            tail -20 server.log
            
            echo "✅ 완료: http://13.209.84.93:3000"