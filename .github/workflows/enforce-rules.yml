name: ğŸš¨ ê·œì¹™ ê°•ì œ ì ìš©

on:
  push:
    branches: [ master, main, develop ]
  pull_request:
    branches: [ master, main, develop ]

jobs:
  validate-no-fake-data:
    name: ê°€ì§œ ë°ì´í„° ê²€ì¦
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: ğŸ” ê°€ì§œ ë°ì´í„° ê²€ì¦
      run: |
        cd frontend
        node scripts/enforce-no-fake-data.js
        
    - name: ğŸ“Š Math.random ì‚¬ìš© ì¹´ìš´íŠ¸
      run: |
        echo "Math.random ì‚¬ìš© íšŸìˆ˜:"
        grep -r "Math.random" frontend --include="*.tsx" --include="*.ts" --exclude-dir=node_modules --exclude-dir=.next | wc -l
        
    - name: ğŸš« ê¸ˆì§€ í‚¤ì›Œë“œ ê²€ìƒ‰
      run: |
        echo "ê¸ˆì§€ í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼:"
        if grep -r "mock\|fake\|dummy\|simulate\|sample" frontend --include="*.tsx" --include="*.ts" --exclude-dir=node_modules --exclude-dir=.next; then
          echo "âŒ ê¸ˆì§€ í‚¤ì›Œë“œ ë°œê²¬!"
          exit 1
        else
          echo "âœ… ê¸ˆì§€ í‚¤ì›Œë“œ ì—†ìŒ"
        fi
        
    - name: ğŸ’¯ í•˜ë“œì½”ë”© ê²€ì¦
      run: |
        echo "í•˜ë“œì½”ë”©ëœ ê°’ ê²€ìƒ‰:"
        if grep -r "price: [0-9]\|amount: [0-9]\|value: [0-9]" frontend --include="*.tsx" --include="*.ts" --exclude-dir=node_modules --exclude-dir=.next; then
          echo "âš ï¸ í•˜ë“œì½”ë”©ëœ ê°’ ë°œê²¬ - ê²€í†  í•„ìš”"
        fi

    - name: âœ… ê²€ì¦ ì™„ë£Œ
      if: success()
      run: echo "âœ… ëª¨ë“  ê·œì¹™ ê²€ì¦ í†µê³¼!"
      
    - name: âŒ ê²€ì¦ ì‹¤íŒ¨
      if: failure()
      run: |
        echo "âŒ ê·œì¹™ ìœ„ë°˜ ë°œê²¬! PR/Push ì°¨ë‹¨ë¨."
        echo "ìˆ˜ì • ë°©ë²•:"
        echo "1. Math.random() â†’ ì‹¤ì œ API ë°ì´í„° ì‚¬ìš©"
        echo "2. mock/fake/dummy â†’ ì‹¤ì œ ë°ì´í„° ì—°ë™"
        echo "3. í•˜ë“œì½”ë”© ê°’ â†’ ì„¤ì • íŒŒì¼ì´ë‚˜ DBì—ì„œ ê°€ì ¸ì˜¤ê¸°"
        exit 1